<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="Mapping.css" />
        <!-- 부트스트랩 CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
        <title>SKHU ROAD</title>
    </head>
    <body>
        <%- include('./__GNB') %>

        <!-- #region 헤더 -->
        <header class="jumbotron">
            <div class="container text-center">
                <h1 class="display-4">Mapping</h1>
                <p class="lead">아직 기능이 완성되지 않았습니다.</p>
            </div>
        </header>
        <!-- #endregion 헤더 -->

        <!-- #region 위치 검색 -->
        <div class="container mt-4">
            <div class="row">
                <div class="col-md-12">
                    <div id="map"></div>
                    <div class="input-group mt-4">
                        <input type="text" class="form-control" placeholder="위치 검색" />
                        <button id="btn" class="btn btn-primary" type="button">검색</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- #endregion 위치 검색 -->

        <span style="line-height: 300px"><br /></span>

        <%- include('./__Footer') %>

        <script>
            function initMap() {
                // 지도 초기화
                var map = new google.maps.Map(document.getElementById("map"), {
                    center: { lat: 37.5665, lng: 126.978 }, // 초기 위치 설정 (서울)
                    zoom: 12, // 확대/축소 레벨
                });

                // 위치 검색 버튼 클릭 시 이벤트 처리
                document.querySelector(".btn").addEventListener("click", function () {
                    var input = document.querySelector(".form-control").value;
                    var geocoder = new google.maps.Geocoder();

                    geocoder.geocode({ address: input }, function (results, status) {
                        if (status === "OK") {
                            map.setCenter(results[0].geometry.location);
                            var marker = new google.maps.Marker({
                                map: map,
                                position: results[0].geometry.location,
                            });
                        } else {
                            alert("요청을 완료하지 못했습니다. 상태: " + status);
                        }
                    });
                });
            }

            if("geolocation" in navigator){
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        sendLocation(latitude,longitude);
                    },
                    error => {

                    }
                );
            }
            else{

            }
            function sendLocation(){
                const latitude = 37.5665; // 서울
                const longitude = 126.978;

                fetch('/mapping',{method:'POST',
                headers:{
                    'Content-Type':'application/json'
                },
                body:JSON.stringify({latitude,longitude})
            })
            
            .then(response => response.text())
            .catch(
 
                )
            }

            document.getElementById("btn").addEventListener('click',sendLocation(latitude,longitude));
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsmoFLqupsLIZtJGrerrEuNkrnW_8NnCI&callback=initMap" async defer></script>
    </body>
</html>
